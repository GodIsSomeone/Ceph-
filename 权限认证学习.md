### 认证过程简介

#### **auth_regitry的创建**  

在rgw_main.cc:main()中进行初始化auth_registry对象  

```
/*rgw_main.cc*/
/* Initialize the registry of auth strategies which will coordinate
* the dynamic reconfiguration. */
auto auth_registry = \
    rgw::auth::StrategyRegistry::create(g_ceph_context, store);
```

#### **very_request()进行认证**

当请求来临的时候，对用户信息进行分析和认证。  

```
/* rgw_process.cc */
ldpp_dout(op, 2) << "verifying requester" << dendl;
ret = op->verify_requester(auth_registry);
```

### 关键数据结构介绍

#### engine的结构图：
engine的结构图：
![avatar](./pic/auth/engine.png)

#### authorize的结构图：
![avatar](./pic/auth/authorize.png)

strategy的结构图：
![avatar](./pic/auth/strategy.png)

### 认证流程分析



### 参考文献

[Amazon Simple Storage Service Developer Guide](https://docs.aws.amazon.com/AmazonS3/latest/dev/s3-dg.pdf)
[Amazon Simple Storage Service API Reference](https://docs.aws.amazon.com/AmazonS3/latest/API/s3-api.pdf)
[RGW LDAP Authentication](http://docs.ceph.com/docs/master/radosgw/ldap-auth/)
[Ceph RGW的身份验证代码概览](http://sealblog.com/2018/03/02/rgw-auth/)
[Ceph浅析（中）：结构、工作原理及流程](https://my.oschina.net/wdyoschina/blog/709198)